# psqlDumpAnalyzer
Данная программа использует [DLL для создания файла дампа](https://github.com/oreshkin75/CreateRAMDumpDLL)
- Анализ дампов PostgreSQL
- Работает только в ОС Windows
- Программа позволяет сделать дамп текущего процесса psql и прочитать его содержимое
- Также есть возможность поиска данных выполненного запроса

Конфигурация осщуествляется через веб-интерфейс (также есть возможность настройки через .env файл, который указывается первым аргументом при запуске программы)
### Архитектура
![изображение](https://user-images.githubusercontent.com/40633594/162026371-bd9d7a4f-c5df-47a8-a694-ecdb2ab68321.png)

### Модуль Configs
Данный модуль отвечает за чтение конфигурационного файла. Конфигурационный файл должен быть заполнен в формате переменных окружения (.env) и путь к файлу передается в виде первого аргумента командной строки программы. Также есть возможность запуска программы без указания пути к файлу. 
Модуль читает переменные окружения из файла и задает их, как переменных окружения для программы. Если какая-нибудь строка необходимая для работы программы не задана в файле, то будет использоваться значение по умолчанию (для каждой строки оно свое). Если путь до файла не был указан, то все значения будут выставлены по умолчанию (в графическом интерфейсе будет возможность поменять некоторые из них)
Файл конфигурации включает в себя:
- DLL_PATH: путь до DLL для создания дампа
- DUMP_DIRECTORY: путь до директории, куда будут сохраняться полученные дамп файлы
- PROCESS_NAME: имя процесса, дамп которого нужно создать (в курсовой работе postgres.exe)
- FUNCTION_NAME: имя функции, которая создает дамп в DLL
- LOG_INFO: файл лога сообщений, не содержащих ошибок (может быть задан stdout)
- LOG_ERROR: файл лога сообщений, содержащий ошибки (может быть задан stdout)
- PSQL_PORT: порт, который использует запущенный процесс PSQL
- PSQL_IP: ip адрес, который использует запущенный процесс PSQL (может быть localhost)
- PSQL_USER: имя пользователя PSQL, от которого могут выполняться запросы
- PSQL_PASSWORD: пароль пользователя
- PSQL_DBNAME: имя базы данных PSQL, в которой могут выполняться запросы
- HTML_MAIN_PAGE: путь до главной страницы графического веб-интерфейса. Все страницы используют путь по умолчанию, если не был указан файл конфигурации. Для данной страницы - ./web/templates/mainPage.html
- HTML_CONFIGURE_PAGE: путь до страницы конфигурации. Все страницы используют путь по умолчанию, если не был указан файл конфигурации. Для данной страницы - ./web/templates/configurePage.html
- HTML_ERROR_PAGE: путь до страницы ошибки. Все страницы используют путь по умолчанию, если не был указан файл конфигурации. Для данной страницы - ./web/templates/errorPage.html
- HTML_DUMP_PAGE: путь до страницы просмотра дампа. Все страницы используют путь по умолчанию, если не был указан файл конфигурации. Для данной страницы - ./web/templates/dumpPage.html

### Модуль logging
Данный модуль инициализирует логирование программы. Создает два файла (потока вывода) для логирования важной информации и ошибок. Также через файл конфигурации есть возможность задать один файл (поток вывода) для логирования важной информации и ошибок.

### Модуль ui
Данный модуль является основным, использование которого начинается после инициализации файла конфигурации и логирования. Он отвечает за работу графического веб-интерфейса и вызов остальных модулей. Описание графического интерфейса будет рассмотрено далее.
Также данный модуль создает очищенный текстовый файл всего дампа.

### Модуль psql
Данный модуль отвечает за подключение к СУБД PostgreSQL и выполнение запросов. Доступны запросы:
- Select
- Insert
- Update
- Delete

Только запрос select позволяет начать поиск данных возвращаемых данным запросом.

### Модуль platform
Единственный платформозависимый модуль данной программы. Работает только в ос Windows. Позволяет создать дамп, вызвав функцию из DLL. Также осуществляет поиск id программы по ее названию.
Так как PostgreSQL порождает множество процессов во время работы – возникла необходимость реализовать возможность поиска процесса, в котором обрабатывается запрос. Данный модуль решает эту задачу и находит именно тот модуль, в котором был выполнен запрос. Этот подход позволяет не выполнять “тяжеловесную” операцию создания дампа для каждого процесса PostgreSQL, также не возникает необходимости анализа дампа каждого процесса для поиска необходимой информации.
Алгоритм поиска нужного процесса состоит в следующем:
- Пользователь нажимает кнопку сделать дамп.
- Модуль производит поиск всех процессов postgres.exe и сохраняет их номера.
- Происходит выполнение запроса в модуле psql.
- Модуль снова производит поиск всех процессов postgres.exe и сравнивает новый список со старым.
- Процесс, который отсутствовал в первом списке искомый.

### Модуль dumps
Данный модуль обрабатывает данные, прочитанные из файла дампа. Удаляет нули и символы, которые невозможно отобразить.
